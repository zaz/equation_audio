<!doctype html>
<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.9.2/math.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.3.slim.min.js"></script>
	<script>
		window.AudioContext = window.AudioContext || window.webkitAudioContext

		let context = new AudioContext()
		let sRate = context.sampleRate
		let volume = 1
		let seconds = 6

		playSound = buf => {
			let buffer = context.createBuffer(1, buf.length, sRate)
			buffer.copyToChannel(buf, 0)
			let source = context.createBufferSource()
			source.buffer = buffer
			source.connect(context.destination)
			source.start(0)
		}

		generateSound = equation => {
			let arr = new Float32Array(sRate * seconds)
			for (let i = 0; i < sRate * seconds; i++) {
				arr[i] = equation.eval({t: i / sRate}) * volume
			}
			return arr
		}

		$( () => {
			let expression = $("form textarea")

			expression.on('keypress', e => {
				if (e.which != 13) { return }  // do nothing unless it's the Enter key
				try {
					let equation = math.compile(expression.val())
					expression.css("background", "inherit")
					playSound(generateSound(equation))
				} catch(err) {
					console.log(err)
					expression.css("background", "#C00000")
				}
				e.preventDefault()
			})
		})
	</script>
	<style>
	html, body { height: 100% }
	body {
		display: flex;
		justify-content: center;
		align-items: center;
		height: 100%;
		margin: 0;
	}
	p {
		text-align: center;
	}
	form {
		width: 100%;
	}
	textarea {
		font-size: 20px;
		width: 100%;
		height: 1.2em;
		padding: .6em 0;
		text-align: center;
		border: 0;
	}
	@media (prefers-color-scheme: dark) {
		body, textarea {
			color: #fff;
			background: #000;
		}
	}
	</style>
</head>
<body>
	<a href="https://github.com/zaz/equation_audio">
		<img style="position: absolute; top: 0; right: 0; border: 0;" decoding="async" loading="lazy" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_gray_6d6d6d.png?resize=149%2C149" alt="Fork me on GitHub" data-recalc-dims="1">
	</a>
	<form>
	<p>
		Enter the equation for a wave below, then press <kbd>Enter</kbd> to play that wave as audio.
	</p>
		<textarea autofocus>.2 sin(t*440*pi*2)</textarea><br>
	</form>
</body>
</html>
